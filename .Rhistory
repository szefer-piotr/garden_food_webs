trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- plantbio[plantbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
biofulldf <- rbind(biofulldf, subdf)
subdf
biofulldf <- data.frame()
# Plots with biomass
for(pcode in as.character(treats$codes)){
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio")
subdf <- data.frame()
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
biofulldf <- rbind(biofulldf, subdf)
}
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio")
subinsct
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio")
subinsdat
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
subinsdat
ins_bio
unique(ins_bio$plot)
trt <- as.character(treats[treats$codes == pcode, "treat"])
trt
print(pcode)
table(ins_bio$plot, ins_bio$amount)
class(ins_bio$amount)
tapply(ins_bio$amount,ins_bio$plot, sum)
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio")
subinsct
contingencyTable2(subinsdat, "tree", "family", "totbio")
subinsdat
# Biomasses of insects per plot per plant
biofulldf <- data.frame()
# Plots with biomass
for(pcode in as.character(treats$codes)){
if(pcode == "w1g1p6"){
break
}
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio")
subdf <- data.frame()
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
biofulldf <- rbind(biofulldf, subdf)
}
# Biomasses of insects per plot per plant
biofulldf <- data.frame()
# Plots with biomass
for(pcode in as.character(treats$codes)){
if(pcode == "w1g1p6"){
next
}
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio")
subdf <- data.frame()
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
biofulldf <- rbind(biofulldf, subdf)
}
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
subinsdat
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
pbio
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio")
subinsdat
subinsdat
###to remove
dataset <- subinsdat
# Get rid of the empty factors
dataset[, colnames(dataset) == ROW] <- as.character(dataset[, colnames(dataset) == ROW])
###to remove
dataset <- subinsdat
ROW <- "tree"
COL <- "family"
VALUE <- "totbio"
# Get rid of the empty factors
dataset[, colnames(dataset) == ROW] <- as.character(dataset[, colnames(dataset) == ROW])
dataset[, colnames(dataset) == COL] <- as.character(dataset[, colnames(dataset) == COL])
# Make a table, get rid of the empty rows and columns
plants <- table(dataset[, colnames(dataset) == ROW], dataset[, colnames(dataset) == COL])
plants <- plants[rowSums(plants) != 0, colSums(plants) != 0]
# See where to insert values
allSpecCodes <- colnames(plants)
allPlotCodes <- rownames(plants)
entries <- which(plants != 0, arr.ind = TRUE)
dim(entries)
entries
allSpecCodes
allPlotCodes
plants
plants
dataset
# Make a table, get rid of the empty rows and columns
plants <- table(dataset[, colnames(dataset) == ROW], dataset[, colnames(dataset) == COL])
plants
plants <- plants[rowSums(plants) != 0, colSums(plants) != 0]
plants
# Make a table, get rid of the empty rows and columns
plants <- table(dataset[, colnames(dataset) == ROW], dataset[, colnames(dataset) == COL])
allPlotCodes <- rownames(plants)
allPlotCodes
entries <- which(plants != 0, arr.ind = TRUE)
entries
# Make a table, get rid of the empty rows and columns
plants <- table(dataset[, colnames(dataset) == ROW], dataset[, colnames(dataset) == COL])
plants
plants
rowSums(plants)
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio",FALSE)
source("code/contingencyTable.R")
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio",FALSE)
subinsct
subdf <- data.frame()
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
biofulldf <- rbind(biofulldf, subdf)
# Biomasses of insects per plot per plant
biofulldf <- data.frame()
# Plots with biomass
for(pcode in as.character(treats$codes)){
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio",FALSE)
subdf <- data.frame()
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
biofulldf <- rbind(biofulldf, subdf)
}
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plants
source("code/contingencyTable.R")
source("code/contingencyTable.R")
library("bipartite")
library("igraph")
insects <- read.table("datasets/arthropods_clean.txt")
treats  <- read.table("datasets/treatments_clean.txt")
plants  <- read.table("datasets/plants_clean.txt")
size_dat <-read.table("datasets/size_dat_bio.txt")
# Attach biomass measurments to othe main insects dataset
rownames(size_dat) <- size_dat$morph
arthbio  <- size_dat[as.character(insects$morphotype), ]
ins_bio <- cbind(insects, arthbio[, c("morph", "bio")])
ins_bio$totbio <- ins_bio$amount * ins_bio$bio
# Insect abundances
tapply(ins_bio$amount,ins_bio$plot, sum)
ins_bio[ins_bio$plot == pcode,]
# Biomasses of insects per plot per plant
biofulldf <- data.frame()
# Plots with biomass
for(pcode in as.character(treats$codes)){
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio",FALSE)
subdf <- data.frame()
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
biofulldf <- rbind(biofulldf, subdf)
}
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio",FALSE)
subdf <- data.frame()
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
row
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
plbio
trt
bio
nms
subinsct
row
subinsct[row,]
as.matrix(subinsct[row,])
plnm
nms
if(nms == NULL){print("yup")}
nms
if(is.null(nms)){print("yup")}
if(is.null(nms)){rownames(subinsct[row,])}
rownames(subinsct[row,])
rownames(subinsct)[row,]
rownames(subinsct)
subdf
biofulldf
# CONTINGENCY TABLE PROBLEM!!!!
pcode <- "w1g3p2"
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio",FALSE)
subdf <- data.frame()
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
if(is.null(nms)){rownames(subinsct)}
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
subdf
nms
subinsct
as.matrix(subinsct[row,]
)
subinsct
# CONTINGENCY TABLE PROBLEM!!!!
pcode <- "w1g1p1"
# Biomasses of insects per plot per plant
biofulldf <- data.frame()
# Plots with biomass
for(pcode in as.character(treats$codes)){
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio",FALSE)
subdf <- data.frame()
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
if(is.null(nms)){colnames(subinsct)}
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
biofulldf <- rbind(biofulldf, subdf)
}
row
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
if(is.null(nms)){colnames(subinsct)}
if(is.null(nms)){nms <- colnames(subinsct)}
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
ssdf
# Biomasses of insects per plot per plant
biofulldf <- data.frame()
# Plots with biomass
for(pcode in as.character(treats$codes)){
print(pcode)
subinsdat <- ins_bio[ins_bio$plot == pcode,] # get insect biomass
plantcodes <- unique(subinsdat$tree) # see which plants have to be extracted
plantbio <- plants[(plants$CODE == pcode & plants$SP_CODE %in% plantcodes), c("SP_CODE","WEIGHT")] # in KG
plantbio$SP_CODE <- as.character(plantbio$SP_CODE)
cumWeight <- tapply(plantbio$WEIGHT,
plantbio$SP_CODE,
sum)
pbio <- data.frame(SP_CODE = rownames(cumWeight),
WEIGHT = cumWeight)
rownames(pbio) <- pbio[,1]
plantb <- pbio[,2]
names(plantb) <- pbio[,1]
subinsct <- contingencyTable2(subinsdat, "tree", "family", "totbio",FALSE)
subdf <- data.frame()
# Collect data for a given plant within a plot
for(row in 1:nrow(subinsct)){
plnm <- rownames(subinsct)[row]
nms <- rownames(as.matrix(subinsct[row,]))
if(is.null(nms)){nms <- colnames(subinsct)}
bio <- as.matrix(subinsct[row,])
trt <- as.character(treats[treats$codes == pcode, "treat"])
plbio <- pbio[pbio$SP_CODE == plnm, "WEIGHT"]
ssdf <- data.frame(bio=bio, nms=nms, plnm=plnm,
trt=trt,plbio=plbio)
subdf <- rbind(subdf, ssdf)
}
biofulldf <- rbind(biofulldf, subdf)
}
biofulldf
